<script setup lang="ts">
import { onMounted, onUnmounted, ref, computed } from 'vue';
import Character from '../types/Character';

const API_URL: string = 'https://rickandmortyapi.com/api/character?page=';
const reqN = ref<number>(1);

const statusObj = {
  Alive: '',
};

const fetchData = async () => {
  //console.log(reqN.value);
  const url: string = `${API_URL}${reqN.value}`;
  //console.log(url);
  let dataArray: Array<Character> = [];
  dataArray = (await (await fetch(url)).json()).results;
  //console.log(dataArray);
  reqN.value = reqN.value + 1;
  //console.log(reqN.value);
  return dataArray;
};

const data = ref<Character[]>([]);
const scrollComponent = ref(null);

const loadMoreCharacters = async () => {
  let newCharacters: Array<Character> = await fetchData();
  data.value.push(...newCharacters);
  console.log(data.value);
};

const changeSvg = computed<any>((id: number) => {
  return id % 5 === 0
    ? 5
    : id % 4 === 0
    ? 4
    : id % 3 === 0
    ? 3
    : id % 2 === 0
    ? 2
    : 0;
});

onMounted(() => {
  loadMoreCharacters();
});

onMounted(() => {
  window.addEventListener('scroll', handleScroll);
});

onUnmounted(() => {
  window.removeEventListener('scroll', handleScroll);
});

const handleScroll = () => {
  let element: any = scrollComponent.value;
  if (element.getBoundingClientRect().bottom < window.innerHeight) {
    loadMoreCharacters();
  }
};
</script>

<template>
  <div class="visor" ref="scrollComponent">
    <div v-for="d in data" :key="d.id">
      <div class="card">
        <div class="top">
          <img :src="d.image" alt="" />
          <div class="card-info">
            <div class="name">Name: {{ d.name }} ({{ d.gender }})</div>
            <div class="species">Species: {{ d.species }}</div>
            <div class="origin">Origin: {{ d.origin?.name || 'Unknown' }}</div>
          </div>
        </div>
        <div class="bottom">
          <div class="origin">
            Location: {{ d.location?.name || 'Unknown' }}
          </div>
          <div class="status">
            {{ d.status }}
          </div>
        </div>
      </div>
      <svg
        v-if="d.id % 5 === 0"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 1440 320"
        class="waves"
      >
        <path
          d="M0,128L6.2,160C12.3,192,25,256,37,245.3C49.2,235,62,149,74,101.3C86.2,53,98,43,111,80C123.1,117,135,203,148,208C160,213,172,139,185,101.3C196.9,64,209,64,222,85.3C233.8,107,246,149,258,186.7C270.8,224,283,256,295,224C307.7,192,320,96,332,101.3C344.6,107,357,213,369,245.3C381.5,277,394,235,406,186.7C418.5,139,431,85,443,58.7C455.4,32,468,32,480,58.7C492.3,85,505,139,517,165.3C529.2,192,542,192,554,186.7C566.2,181,578,171,591,181.3C603.1,192,615,224,628,234.7C640,245,652,235,665,240C676.9,245,689,267,702,229.3C713.8,192,726,96,738,80C750.8,64,763,128,775,149.3C787.7,171,800,149,812,170.7C824.6,192,837,256,849,261.3C861.5,267,874,213,886,181.3C898.5,149,911,139,923,160C935.4,181,948,235,960,261.3C972.3,288,985,288,997,261.3C1009.2,235,1022,181,1034,149.3C1046.2,117,1058,107,1071,133.3C1083.1,160,1095,224,1108,218.7C1120,213,1132,139,1145,138.7C1156.9,139,1169,213,1182,234.7C1193.8,256,1206,224,1218,224C1230.8,224,1243,256,1255,240C1267.7,224,1280,160,1292,117.3C1304.6,75,1317,53,1329,42.7C1341.5,32,1354,32,1366,74.7C1378.5,117,1391,203,1403,240C1415.4,277,1428,267,1434,261.3L1440,256L1440,0L1433.8,0C1427.7,0,1415,0,1403,0C1390.8,0,1378,0,1366,0C1353.8,0,1342,0,1329,0C1316.9,0,1305,0,1292,0C1280,0,1268,0,1255,0C1243.1,0,1231,0,1218,0C1206.2,0,1194,0,1182,0C1169.2,0,1157,0,1145,0C1132.3,0,1120,0,1108,0C1095.4,0,1083,0,1071,0C1058.5,0,1046,0,1034,0C1021.5,0,1009,0,997,0C984.6,0,972,0,960,0C947.7,0,935,0,923,0C910.8,0,898,0,886,0C873.8,0,862,0,849,0C836.9,0,825,0,812,0C800,0,788,0,775,0C763.1,0,751,0,738,0C726.2,0,714,0,702,0C689.2,0,677,0,665,0C652.3,0,640,0,628,0C615.4,0,603,0,591,0C578.5,0,566,0,554,0C541.5,0,529,0,517,0C504.6,0,492,0,480,0C467.7,0,455,0,443,0C430.8,0,418,0,406,0C393.8,0,382,0,369,0C356.9,0,345,0,332,0C320,0,308,0,295,0C283.1,0,271,0,258,0C246.2,0,234,0,222,0C209.2,0,197,0,185,0C172.3,0,160,0,148,0C135.4,0,123,0,111,0C98.5,0,86,0,74,0C61.5,0,49,0,37,0C24.6,0,12,0,6,0L0,0Z"
        ></path>
      </svg>
      <svg
        v-else-if="d.id % 4 === 0"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 1440 320"
        class="waves"
      >
        <path
          d="M0,192L6.2,208C12.3,224,25,256,37,261.3C49.2,267,62,245,74,213.3C86.2,181,98,139,111,117.3C123.1,96,135,96,148,112C160,128,172,160,185,149.3C196.9,139,209,85,222,106.7C233.8,128,246,224,258,224C270.8,224,283,128,295,117.3C307.7,107,320,181,332,197.3C344.6,213,357,171,369,149.3C381.5,128,394,128,406,117.3C418.5,107,431,85,443,96C455.4,107,468,149,480,165.3C492.3,181,505,171,517,181.3C529.2,192,542,224,554,245.3C566.2,267,578,277,591,266.7C603.1,256,615,224,628,202.7C640,181,652,171,665,144C676.9,117,689,75,702,85.3C713.8,96,726,160,738,154.7C750.8,149,763,75,775,85.3C787.7,96,800,192,812,197.3C824.6,203,837,117,849,85.3C861.5,53,874,75,886,85.3C898.5,96,911,96,923,85.3C935.4,75,948,53,960,85.3C972.3,117,985,203,997,234.7C1009.2,267,1022,245,1034,208C1046.2,171,1058,117,1071,128C1083.1,139,1095,213,1108,213.3C1120,213,1132,139,1145,106.7C1156.9,75,1169,85,1182,112C1193.8,139,1206,181,1218,192C1230.8,203,1243,181,1255,197.3C1267.7,213,1280,267,1292,282.7C1304.6,299,1317,277,1329,256C1341.5,235,1354,213,1366,208C1378.5,203,1391,213,1403,213.3C1415.4,213,1428,203,1434,197.3L1440,192L1440,0L1433.8,0C1427.7,0,1415,0,1403,0C1390.8,0,1378,0,1366,0C1353.8,0,1342,0,1329,0C1316.9,0,1305,0,1292,0C1280,0,1268,0,1255,0C1243.1,0,1231,0,1218,0C1206.2,0,1194,0,1182,0C1169.2,0,1157,0,1145,0C1132.3,0,1120,0,1108,0C1095.4,0,1083,0,1071,0C1058.5,0,1046,0,1034,0C1021.5,0,1009,0,997,0C984.6,0,972,0,960,0C947.7,0,935,0,923,0C910.8,0,898,0,886,0C873.8,0,862,0,849,0C836.9,0,825,0,812,0C800,0,788,0,775,0C763.1,0,751,0,738,0C726.2,0,714,0,702,0C689.2,0,677,0,665,0C652.3,0,640,0,628,0C615.4,0,603,0,591,0C578.5,0,566,0,554,0C541.5,0,529,0,517,0C504.6,0,492,0,480,0C467.7,0,455,0,443,0C430.8,0,418,0,406,0C393.8,0,382,0,369,0C356.9,0,345,0,332,0C320,0,308,0,295,0C283.1,0,271,0,258,0C246.2,0,234,0,222,0C209.2,0,197,0,185,0C172.3,0,160,0,148,0C135.4,0,123,0,111,0C98.5,0,86,0,74,0C61.5,0,49,0,37,0C24.6,0,12,0,6,0L0,0Z"
        ></path>
      </svg>
      <svg
        v-else-if="d.id % 3 === 0"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 1440 320"
        class="waves"
      >
        <path
          d="M0,64L6.2,69.3C12.3,75,25,85,37,96C49.2,107,62,117,74,106.7C86.2,96,98,64,111,74.7C123.1,85,135,139,148,160C160,181,172,171,185,176C196.9,181,209,203,222,186.7C233.8,171,246,117,258,112C270.8,107,283,149,295,149.3C307.7,149,320,107,332,117.3C344.6,128,357,192,369,197.3C381.5,203,394,149,406,138.7C418.5,128,431,160,443,186.7C455.4,213,468,235,480,250.7C492.3,267,505,277,517,245.3C529.2,213,542,139,554,122.7C566.2,107,578,149,591,149.3C603.1,149,615,107,628,106.7C640,107,652,149,665,170.7C676.9,192,689,192,702,197.3C713.8,203,726,213,738,197.3C750.8,181,763,139,775,106.7C787.7,75,800,53,812,74.7C824.6,96,837,160,849,208C861.5,256,874,288,886,282.7C898.5,277,911,235,923,218.7C935.4,203,948,213,960,202.7C972.3,192,985,160,997,170.7C1009.2,181,1022,235,1034,234.7C1046.2,235,1058,181,1071,176C1083.1,171,1095,213,1108,224C1120,235,1132,213,1145,186.7C1156.9,160,1169,128,1182,128C1193.8,128,1206,160,1218,170.7C1230.8,181,1243,171,1255,154.7C1267.7,139,1280,117,1292,96C1304.6,75,1317,53,1329,90.7C1341.5,128,1354,224,1366,245.3C1378.5,267,1391,213,1403,192C1415.4,171,1428,181,1434,186.7L1440,192L1440,0L1433.8,0C1427.7,0,1415,0,1403,0C1390.8,0,1378,0,1366,0C1353.8,0,1342,0,1329,0C1316.9,0,1305,0,1292,0C1280,0,1268,0,1255,0C1243.1,0,1231,0,1218,0C1206.2,0,1194,0,1182,0C1169.2,0,1157,0,1145,0C1132.3,0,1120,0,1108,0C1095.4,0,1083,0,1071,0C1058.5,0,1046,0,1034,0C1021.5,0,1009,0,997,0C984.6,0,972,0,960,0C947.7,0,935,0,923,0C910.8,0,898,0,886,0C873.8,0,862,0,849,0C836.9,0,825,0,812,0C800,0,788,0,775,0C763.1,0,751,0,738,0C726.2,0,714,0,702,0C689.2,0,677,0,665,0C652.3,0,640,0,628,0C615.4,0,603,0,591,0C578.5,0,566,0,554,0C541.5,0,529,0,517,0C504.6,0,492,0,480,0C467.7,0,455,0,443,0C430.8,0,418,0,406,0C393.8,0,382,0,369,0C356.9,0,345,0,332,0C320,0,308,0,295,0C283.1,0,271,0,258,0C246.2,0,234,0,222,0C209.2,0,197,0,185,0C172.3,0,160,0,148,0C135.4,0,123,0,111,0C98.5,0,86,0,74,0C61.5,0,49,0,37,0C24.6,0,12,0,6,0L0,0Z"
        ></path>
      </svg>
      <svg
        v-else-if="d.id % 2 === 0"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 1440 320"
        class="waves"
      >
        <path
          d="M0,96L6.2,112C12.3,128,25,160,37,160C49.2,160,62,128,74,96C86.2,64,98,32,111,64C123.1,96,135,192,148,213.3C160,235,172,181,185,154.7C196.9,128,209,128,222,117.3C233.8,107,246,85,258,112C270.8,139,283,213,295,250.7C307.7,288,320,288,332,272C344.6,256,357,224,369,197.3C381.5,171,394,149,406,144C418.5,139,431,149,443,133.3C455.4,117,468,75,480,80C492.3,85,505,139,517,165.3C529.2,192,542,192,554,197.3C566.2,203,578,213,591,224C603.1,235,615,245,628,256C640,267,652,277,665,245.3C676.9,213,689,139,702,96C713.8,53,726,43,738,69.3C750.8,96,763,160,775,186.7C787.7,213,800,203,812,213.3C824.6,224,837,256,849,245.3C861.5,235,874,181,886,181.3C898.5,181,911,235,923,213.3C935.4,192,948,96,960,80C972.3,64,985,128,997,138.7C1009.2,149,1022,107,1034,80C1046.2,53,1058,43,1071,74.7C1083.1,107,1095,181,1108,197.3C1120,213,1132,171,1145,176C1156.9,181,1169,235,1182,213.3C1193.8,192,1206,96,1218,101.3C1230.8,107,1243,213,1255,250.7C1267.7,288,1280,256,1292,234.7C1304.6,213,1317,203,1329,213.3C1341.5,224,1354,256,1366,250.7C1378.5,245,1391,203,1403,165.3C1415.4,128,1428,96,1434,80L1440,64L1440,0L1433.8,0C1427.7,0,1415,0,1403,0C1390.8,0,1378,0,1366,0C1353.8,0,1342,0,1329,0C1316.9,0,1305,0,1292,0C1280,0,1268,0,1255,0C1243.1,0,1231,0,1218,0C1206.2,0,1194,0,1182,0C1169.2,0,1157,0,1145,0C1132.3,0,1120,0,1108,0C1095.4,0,1083,0,1071,0C1058.5,0,1046,0,1034,0C1021.5,0,1009,0,997,0C984.6,0,972,0,960,0C947.7,0,935,0,923,0C910.8,0,898,0,886,0C873.8,0,862,0,849,0C836.9,0,825,0,812,0C800,0,788,0,775,0C763.1,0,751,0,738,0C726.2,0,714,0,702,0C689.2,0,677,0,665,0C652.3,0,640,0,628,0C615.4,0,603,0,591,0C578.5,0,566,0,554,0C541.5,0,529,0,517,0C504.6,0,492,0,480,0C467.7,0,455,0,443,0C430.8,0,418,0,406,0C393.8,0,382,0,369,0C356.9,0,345,0,332,0C320,0,308,0,295,0C283.1,0,271,0,258,0C246.2,0,234,0,222,0C209.2,0,197,0,185,0C172.3,0,160,0,148,0C135.4,0,123,0,111,0C98.5,0,86,0,74,0C61.5,0,49,0,37,0C24.6,0,12,0,6,0L0,0Z"
        ></path>
      </svg>

      <svg
        v-else
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 1440 320"
        class="waves"
      >
        <path
          d="M0,128L6.2,144C12.3,160,25,192,37,192C49.2,192,62,160,74,128C86.2,96,98,64,111,64C123.1,64,135,96,148,144C160,192,172,256,185,250.7C196.9,245,209,171,222,133.3C233.8,96,246,96,258,128C270.8,160,283,224,295,250.7C307.7,277,320,267,332,245.3C344.6,224,357,192,369,186.7C381.5,181,394,203,406,218.7C418.5,235,431,245,443,213.3C455.4,181,468,107,480,101.3C492.3,96,505,160,517,181.3C529.2,203,542,181,554,165.3C566.2,149,578,139,591,144C603.1,149,615,171,628,149.3C640,128,652,64,665,80C676.9,96,689,192,702,234.7C713.8,277,726,267,738,266.7C750.8,267,763,277,775,282.7C787.7,288,800,288,812,250.7C824.6,213,837,139,849,122.7C861.5,107,874,149,886,170.7C898.5,192,911,192,923,192C935.4,192,948,192,960,170.7C972.3,149,985,107,997,117.3C1009.2,128,1022,192,1034,192C1046.2,192,1058,128,1071,128C1083.1,128,1095,192,1108,234.7C1120,277,1132,299,1145,282.7C1156.9,267,1169,213,1182,170.7C1193.8,128,1206,96,1218,74.7C1230.8,53,1243,43,1255,69.3C1267.7,96,1280,160,1292,170.7C1304.6,181,1317,139,1329,149.3C1341.5,160,1354,224,1366,218.7C1378.5,213,1391,139,1403,128C1415.4,117,1428,171,1434,197.3L1440,224L1440,0L1433.8,0C1427.7,0,1415,0,1403,0C1390.8,0,1378,0,1366,0C1353.8,0,1342,0,1329,0C1316.9,0,1305,0,1292,0C1280,0,1268,0,1255,0C1243.1,0,1231,0,1218,0C1206.2,0,1194,0,1182,0C1169.2,0,1157,0,1145,0C1132.3,0,1120,0,1108,0C1095.4,0,1083,0,1071,0C1058.5,0,1046,0,1034,0C1021.5,0,1009,0,997,0C984.6,0,972,0,960,0C947.7,0,935,0,923,0C910.8,0,898,0,886,0C873.8,0,862,0,849,0C836.9,0,825,0,812,0C800,0,788,0,775,0C763.1,0,751,0,738,0C726.2,0,714,0,702,0C689.2,0,677,0,665,0C652.3,0,640,0,628,0C615.4,0,603,0,591,0C578.5,0,566,0,554,0C541.5,0,529,0,517,0C504.6,0,492,0,480,0C467.7,0,455,0,443,0C430.8,0,418,0,406,0C393.8,0,382,0,369,0C356.9,0,345,0,332,0C320,0,308,0,295,0C283.1,0,271,0,258,0C246.2,0,234,0,222,0C209.2,0,197,0,185,0C172.3,0,160,0,148,0C135.4,0,123,0,111,0C98.5,0,86,0,74,0C61.5,0,49,0,37,0C24.6,0,12,0,6,0L0,0Z"
        ></path>
      </svg>
    </div>
  </div>
</template>

<style lang="stylus">
@import url('https://fonts.googleapis.com/css2?family=Schoolbell&display=swap');

.visor
    display grid
    grid-template-columns repeat(auto-fit, minmax(400px, 1fr))
    font-family 'Schoolbell', cursive;
    justify-items center

    @media screen and (max-width: 500px)
        justify-content: center

.card
    font-size 1.2rem
    width 100%
    width 400px
    height auto
    background-color #88d684
    margin-top 1rem
    margin-bottom 0
    border-radius 10px 10px 0 0


    img
        width 150px
        height 150px
        margin 1rem
        border-radius  5px

    @media screen and (max-width: 500px)
        width 200px

        img
            align-self center
.top
    display flex
    flex-direction row
    @media screen and (max-width: 500px)
        flex-direction column

.card-info
    display flex
    flex-direction column
    justify-content space-around
    margin 1rem

.bottom
    display flex
    margin 1rem
    justify-content space-between
    margin-bottom 0
    padding-bottom 1rem
    flex-direction row
    @media screen and (max-width: 500px)
        flex-direction column




.waves
    width 100%
    margin-top -1px
    max-width 400px

    path
        fill #88d684

    @media screen and (max-width: 500px)
        width 200px


.status
    z-index 1
    width 50px
    margin-top 1.5rem
    text-align right
    font-size 1.5rem
    font-family 'Schwifty', cursive;
    display inline-table
</style>
